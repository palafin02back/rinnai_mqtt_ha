# 林内热水器 Home Assistant 集成

这是一个用于 Home Assistant 的林内热水器集成组件。本集成基于 Home Assistant 的 MQTT 集成，可以让您通过 Home Assistant 来控制和监控您的林内热水器。

## ⚠️ 重要提示

1. 本集成需要 Home Assistant MQTT 集成支持
2. 目前仅在 `RBS-**G56系列` (设备 ID: `0F06000C`) 上进行过测试
3. 注意：订阅数量过多可能导致账号被临时封禁（返回 rc:5），如遇此情况请更换账号

## 功能特点

- 实时监控热水器状态
- 温度控制
- 电源开关控制
- 模式切换（节能模式、户外模式、快速加热）
- 用水量统计
- 使用时间统计

## 安装前准备

1. 确保您的 Home Assistant 已安装并配置了 MQTT 集成
2. 准备好您的林内智家账号和密码
3. 确保热水器已在林内 APP 中正常工作

## 配置步骤

1. 在 Home Assistant 的集成页面中点击"添加集成"
2. 搜索 "Rinnai Water Heater"
3. 输入以下信息：
   - 林内账号用户名
   - 林内账号密码
   - （可选）MQTT 服务器地址（默认：mqtt.rinnai.com.cn）
   - （可选）MQTT 服务器端口（默认：8883）
   - （可选）更新间隔（默认：30秒）
   - （可选）连接超时时间（默认：10秒）

## 支持的实体

### 传感器
- 当前温度
- 用水量
- 使用时间

### 开关
- 电源开关
- 节能模式
- 户外模式
- 快速加热模式

### 数值调节器
- 目标温度设置

## 工作原理

1. 通过 HTTP 客户端获取设备初始配置
2. 使用 MQTT 客户端连接林内服务器获取实时数据
3. 通过 Home Assistant MQTT 集成处理设备状态和控制命令
4. 实现设备状态的自动发现和更新

## 故障排除

1. 集成添加失败：
   - 检查 Home Assistant MQTT 集成是否已安装并正确配置
   - 验证林内账号信息是否正确
   - 确认网络连接是否正常

2. 设备状态不更新：
   - 检查 MQTT 连接状态
   - 查看日志中是否有错误信息
   - 尝试重启 Home Assistant

3. 控制命令无响应：
   - 确认设备是否在线
   - 检查 MQTT 主题是否正确
   - 查看日志中的错误信息

## 调试

在 `configuration.yaml` 中添加以下配置来启用详细日志：

```yaml
logger:
  default: info
  logs:
    custom_components.rinnai_water_heater: debug
```

## 注意事项

1. 避免频繁修改配置或重启集成，以防触发账号限制
2. 建议使用单独的林内账号用于此集成
3. 如遇到账号被限制，可以等待一段时间或更换账号

## 技术支持

如果您遇到问题：
1. 检查日志文件中的错误信息
2. 确认您的设备型号是否受支持
3. 在 GitHub 仓库提交 issue 